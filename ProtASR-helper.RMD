---
title: "ProtASR-Helper"
author: "Javad Khataei"
date: "March 20, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# ProtASR Helper  
This file read ProtASR2.2 output and analysis the data. It find the aminoacids with the highest probability for each node. If the probability is less than 0.8, it will be market for further analysis.


### Load libraries and read files
```{r load libraries}
library(tidyverse)
library(data.table)
library(stringr)

```


```{r read-files}
file_name <- "ProtASR-sample-output.txt"
raw_lines <- readr::read_lines(file = file_name, skip_empty_rows = TRUE)
df <- data_frame(raw_lines)
```

### Which nodes?
The output file has a line similar to this, `Nodes 75 to 147 are ancestral`, which indicates which nodes to expect. 

```{r node-range}
first_word <-
    df$raw_lines[1:50] %>% stringr::str_split(n = 2, pattern = " ")


for (i in 1:50) {
    if (first_word[[i]][1] == "Nodes") {
        print(df$raw_lines[i])
        first_node_number <-
        stringr::str_split(string = raw_lines[i], pattern = " ")[[1]][2] %>%  
            as.numeric()
        last_node_number <-
        stringr::str_split(string = raw_lines[i], pattern = " ")[[1]][4] %>%  
            as.numeric()
        
    }
}
```


```{r to-dataframe}
# the plan was using one space(" ") as split pattern to convert the line to a series of colums but the number of  spaces changes in lines. The "site" increase and that reduces the spaces so can't use space to split.
# that why the following lines are commented out
# words_in_line <- df$raw_lines %>%
#     stringr::str_split_fixed(n= 40, pattern = " ") %>% 
#     as_tibble()
# 
# # Column V5 has the node number and a comma. delete the comma
# words_in_line$V5 <- words_in_line$V5 %>%
#     stringr::str_remove_all(",") 

# Trim the dat frame and select useful columns
#working_df <- words_in_line %>% select(c(V5, V16:V38))

# How to solve it?
# Split by :. Note there is a : in lines
words_in_line <- df$raw_lines %>%
    stringr::str_split_fixed(n= 2, pattern = ":") %>%
    as_data_frame()

# now use space to split and select the last solumn
# V5 has the node number and V14 the  letters
working_df <- words_in_line$V1 %>%
    stringr::str_split_fixed(n= 14, pattern = " ") %>%
    as_tibble() %>% 
    select(V5, V14)
# Node numbers have a comma
 working_df$V5 <- working_df$V5 %>%
    stringr::str_remove_all(",")
# Combine with the half after :
working_df <- cbind(working_df,words_in_line$V2)

```


### Clean dataset
Now that we have the important data in a dataframe, we need to clean the dataset.


